# ğŸš€ ç¼–ç¨‹ Agent V3 å®ç°æ€»ç»“

## âœ… å®Œæˆçš„å·¥ä½œ

### ğŸ“‹ 1. æ¶æ„è®¾è®¡
- âœ… åŸºäº Vercel AI SDK çš„å¤šæ­¥éª¤å·¥å…·è°ƒç”¨æ¶æ„
- âœ… ç»Ÿä¸€çš„ BaseAgentV2 åŸºç±»ç»§æ‰¿
- âœ… å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… ä¸‰ç§å¤„ç†æ¨¡å¼ï¼šåˆå§‹é¡¹ç›®ç”Ÿæˆã€å¢é‡ä¿®æ”¹ã€ä»£ç åˆ†æ

### ğŸ› ï¸ 2. å·¥å…·é›†å®ç°
- âœ… **æ–‡ä»¶æ“ä½œå·¥å…·**ï¼š`read_file`, `write_file`, `edit_file`, `append_to_file`, `delete_file`
- âœ… **ä»£ç åˆ†æå·¥å…·**ï¼š`search_code`, `get_file_structure`, `list_files`
- âœ… **æ‰§è¡Œå·¥å…·**ï¼š`run_command`
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒæˆåŠŸåé¦ˆæœºåˆ¶

### ğŸ’» 3. æ ¸å¿ƒåŠŸèƒ½
- âœ… **æ™ºèƒ½æ¨¡å¼æ£€æµ‹**ï¼šåŸºäºç”¨æˆ·è¾“å…¥è‡ªåŠ¨åˆ¤æ–­å¤„ç†æ¨¡å¼
- âœ… **é¡¹ç›®ç»“æ„åˆ†æ**ï¼šè‡ªåŠ¨åˆ†æé¡¹ç›®æ¡†æ¶å’Œä¾èµ–
- âœ… **å·¥ä½œç›®å½•ç®¡ç†**ï¼šæ”¯æŒè®¾ç½®å’Œç®¡ç†å·¥ä½œç›®å½•
- âœ… **æµå¼å“åº”å¤„ç†**ï¼šå®æ—¶åé¦ˆå¤„ç†è¿›åº¦å’Œç»“æœ

### ğŸ§ª 4. æµ‹è¯•éªŒè¯
- âœ… åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯• API ç«¯ç‚¹
- âœ… éªŒè¯äº†ä¸‰ç§å¤„ç†æ¨¡å¼çš„åŠŸèƒ½
- âœ… æµ‹è¯•äº†å·¥å…·è°ƒç”¨å’Œé”™è¯¯å¤„ç†æœºåˆ¶

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### ğŸ”„ ä¸‰ç§å¤„ç†æ¨¡å¼

#### 1. åˆå§‹é¡¹ç›®ç”Ÿæˆæ¨¡å¼ (`initial`)
```typescript
// é€‚ç”¨åœºæ™¯ï¼šåˆ›å»ºæ–°é¡¹ç›®ã€ç”Ÿæˆå®Œæ•´é¡¹ç›®ç»“æ„
const context = {
  mode: 'initial',
  framework: 'Next.js',
  tech_stack: 'React + TypeScript',
  project_type: 'Webåº”ç”¨'
};
```

**åŠŸèƒ½ç‰¹ç‚¹**ï¼š
- ğŸš€ å®Œæ•´é¡¹ç›®ç»“æ„ç”Ÿæˆ
- ğŸ“¦ è‡ªåŠ¨å®‰è£…ä¾èµ–
- ğŸ¨ åŸºç¡€ç»„ä»¶å’Œé¡µé¢åˆ›å»º
- âš™ï¸ é…ç½®æ–‡ä»¶ç”Ÿæˆ

#### 2. å¢é‡ä¿®æ”¹æ¨¡å¼ (`incremental`)
```typescript
// é€‚ç”¨åœºæ™¯ï¼šä¿®æ”¹ç°æœ‰ä»£ç ã€æ·»åŠ åŠŸèƒ½ã€ä¼˜åŒ–ä»£ç 
const context = {
  mode: 'incremental',
  target_files: 'components/Button.tsx',
  modification_type: 'add_feature'
};
```

**åŠŸèƒ½ç‰¹ç‚¹**ï¼š
- ğŸ”§ ç²¾ç¡®çš„æ–‡ä»¶ä¿®æ”¹
- ğŸ“Š é¡¹ç›®ç»“æ„åˆ†æ
- ğŸ¯ æœ€å°åŒ–å˜æ›´åŸåˆ™
- ğŸ”„ å‘åå…¼å®¹ä¿è¯

#### 3. ä»£ç åˆ†ææ¨¡å¼ (`analysis`)
```typescript
// é€‚ç”¨åœºæ™¯ï¼šä»£ç å®¡æŸ¥ã€ç»“æ„åˆ†æã€é—®é¢˜è¯Šæ–­
const context = {
  mode: 'analysis',
  analysis_type: 'code_review'
};
```

**åŠŸèƒ½ç‰¹ç‚¹**ï¼š
- ğŸ” æ·±åº¦ä»£ç åˆ†æ
- ğŸ“ˆ æ€§èƒ½é—®é¢˜è¯†åˆ«
- ğŸ’¡ æ”¹è¿›å»ºè®®æä¾›
- ğŸ“‹ è¯¦ç»†åˆ†ææŠ¥å‘Š

### ğŸ› ï¸ å®Œæ•´å·¥å…·é›†

#### ğŸ“ æ–‡ä»¶æ“ä½œå·¥å…·
```typescript
const fileTools = {
  read_file: 'è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ”¯æŒè¡Œå·èŒƒå›´',
  write_file: 'åˆ›å»ºæ–°æ–‡ä»¶æˆ–å®Œå…¨é‡å†™',
  edit_file: 'ç²¾ç¡®çš„éƒ¨åˆ†ä¿®æ”¹',
  append_to_file: 'åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å†…å®¹',
  delete_file: 'å®‰å…¨åˆ é™¤æ–‡ä»¶'
};
```

#### ğŸ” åˆ†æå·¥å…·
```typescript
const analysisTools = {
  search_code: 'æœç´¢ä»£ç å†…å®¹å’Œæ¨¡å¼',
  get_file_structure: 'è·å–é¡¹ç›®ç»“æ„æ ‘',
  list_files: 'åˆ—å‡ºæ–‡ä»¶æ¸…å•'
};
```

#### ğŸš€ æ‰§è¡Œå·¥å…·
```typescript
const executionTools = {
  run_command: 'æ‰§è¡Œshellå‘½ä»¤ï¼ˆæ„å»ºã€æµ‹è¯•ã€å®‰è£…ç­‰ï¼‰'
};
```

---

## ğŸ—ï¸ æ¶æ„ä¼˜åŠ¿

### âœ… ç›¸æ¯”æ—§ç‰ˆæœ¬çš„æ”¹è¿›

1. **ç»Ÿä¸€å·¥å…·è°ƒç”¨**ï¼š
   - âŒ æ—§ç‰ˆï¼šæ‰‹åŠ¨è§£æå·¥å…·è°ƒç”¨ï¼Œå¤æ‚çš„ XML/JSON è§£æ
   - âœ… æ–°ç‰ˆï¼šVercel AI SDK åŸç”Ÿå¤šæ­¥éª¤å·¥å…·è°ƒç”¨

2. **é”™è¯¯å¤„ç†**ï¼š
   - âŒ æ—§ç‰ˆï¼šå¤æ‚çš„é”™è¯¯æ¢å¤æœºåˆ¶ï¼Œå¤šå±‚å¼‚å¸¸å¤„ç†
   - âœ… æ–°ç‰ˆï¼šSDK åŸç”Ÿé”™è¯¯å¤„ç†ï¼Œç®€åŒ–çš„é”™è¯¯æ¢å¤

3. **ä»£ç ç»´æŠ¤**ï¼š
   - âŒ æ—§ç‰ˆï¼š2000+ è¡Œå¤æ‚é€»è¾‘ï¼Œå¤šä¸ªè§£æå™¨ç±»
   - âœ… æ–°ç‰ˆï¼š800+ è¡Œæ¸…æ™°é€»è¾‘ï¼Œç»Ÿä¸€çš„å·¥å…·å®šä¹‰

4. **ç±»å‹å®‰å…¨**ï¼š
   - âŒ æ—§ç‰ˆï¼šéƒ¨åˆ†åŠ¨æ€ç±»å‹ï¼Œè¿è¡Œæ—¶é”™è¯¯é£é™©
   - âœ… æ–°ç‰ˆï¼šå®Œæ•´ TypeScript ç±»å‹ï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥

### ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. **Token ä½¿ç”¨ä¼˜åŒ–**ï¼š
   - æ™ºèƒ½çš„ä¸Šä¸‹æ–‡ç®¡ç†
   - æŒ‰éœ€åŠ è½½é¡¹ç›®ä¿¡æ¯
   - ç²¾ç¡®çš„å·¥å…·è°ƒç”¨å‚æ•°

2. **å“åº”é€Ÿåº¦æå‡**ï¼š
   - å‡å°‘ä¸å¿…è¦çš„å·¥å…·è°ƒç”¨
   - å¹¶è¡Œå¤„ç†èƒ½åŠ›
   - æµå¼å“åº”ä¼˜åŒ–

3. **èµ„æºç®¡ç†**ï¼š
   - å·¥ä½œç›®å½•éš”ç¦»
   - å†…å­˜ä½¿ç”¨ä¼˜åŒ–
   - æ–‡ä»¶æ“ä½œå®‰å…¨æ€§

---

## ğŸ¯ ä½¿ç”¨æ–¹å¼

### 1. åŸºæœ¬ä½¿ç”¨
```typescript
import { CodingAgentV3 } from '@/lib/agents/v2/coding-agent-v3';

const agent = new CodingAgentV3();
agent.setWorkingDirectory('/path/to/project');

// å¤„ç†ç¼–ç¨‹è¯·æ±‚
for await (const response of agent.processRequest(userInput, sessionData, context)) {
  console.log(response.immediate_display.reply);
  
  if (response.system_state.done) {
    // è·å–å¤„ç†ç»“æœ
    const metadata = response.system_state.metadata;
    console.log('åˆ›å»ºçš„æ–‡ä»¶:', metadata.files_created);
    console.log('ä¿®æ”¹çš„æ–‡ä»¶:', metadata.files_modified);
    console.log('æ‰§è¡Œçš„å‘½ä»¤:', metadata.commands_executed);
  }
}
```

### 2. æ¨¡å¼é…ç½®
```typescript
// åˆå§‹é¡¹ç›®ç”Ÿæˆ
const initialContext = {
  mode: 'initial',
  framework: 'Next.js',
  tech_stack: 'React + TypeScript',
  project_type: 'Webåº”ç”¨'
};

// å¢é‡ä¿®æ”¹
const incrementalContext = {
  mode: 'incremental',
  target_files: 'components/Button.tsx',
  modification_request: 'æ·»åŠ loadingçŠ¶æ€'
};

// ä»£ç åˆ†æ
const analysisContext = {
  mode: 'analysis',
  analysis_type: 'performance_review'
};
```

### 3. å·¥å…·è°ƒç”¨ç¤ºä¾‹
```typescript
// Agent ä¼šæ ¹æ®éœ€æ±‚è‡ªåŠ¨é€‰æ‹©å’Œè°ƒç”¨å·¥å…·
const userInput = `
åˆ›å»ºä¸€ä¸ªReactæŒ‰é’®ç»„ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š
1. æ”¯æŒä¸åŒå°ºå¯¸ï¼ˆsmall, medium, largeï¼‰
2. æ”¯æŒä¸åŒç±»å‹ï¼ˆprimary, secondary, dangerï¼‰
3. æ”¯æŒloadingçŠ¶æ€
4. æ”¯æŒç¦ç”¨çŠ¶æ€
5. åŒ…å«ç‚¹å‡»äº‹ä»¶å¤„ç†
`;

// Agent ä¼šè‡ªåŠ¨ï¼š
// 1. ä½¿ç”¨ get_file_structure åˆ†æé¡¹ç›®ç»“æ„
// 2. ä½¿ç”¨ write_file åˆ›å»ºç»„ä»¶æ–‡ä»¶
// 3. ä½¿ç”¨ write_file åˆ›å»ºæ ·å¼æ–‡ä»¶
// 4. ä½¿ç”¨ edit_file æ›´æ–°å¯¼å‡ºæ–‡ä»¶
// 5. ä½¿ç”¨ run_command å®‰è£…å¿…è¦ä¾èµ–
```

---

## ğŸ“Š é›†æˆå»ºè®®

### 1. æ¸è¿›å¼æ›¿æ¢
```typescript
// åˆ›å»º Agent å·¥å‚ï¼Œæ”¯æŒæ–°æ—§ç‰ˆæœ¬åˆ‡æ¢
class CodingAgentFactory {
  static create(version: 'v2' | 'v3' = 'v3') {
    return version === 'v3' 
      ? new CodingAgentV3()
      : new CodingAgent();
  }
}
```

### 2. é…ç½®ç®¡ç†
```typescript
// ç¯å¢ƒé…ç½®
const config = {
  workingDirectory: process.env.CODING_WORK_DIR || '/tmp/coding',
  maxSteps: parseInt(process.env.MAX_CODING_STEPS || '8'),
  enableFileOperations: process.env.ENABLE_FILE_OPS === 'true',
  allowedCommands: ['npm', 'yarn', 'git', 'mkdir', 'touch']
};
```

### 3. å®‰å…¨è€ƒè™‘
```typescript
// æ–‡ä»¶æ“ä½œå®‰å…¨é™åˆ¶
const securityConfig = {
  allowedDirectories: ['/tmp/coding', '/workspace'],
  blockedFiles: ['.env', 'package-lock.json'],
  allowedCommands: ['npm install', 'npm run build', 'npm test'],
  maxFileSize: 1024 * 1024 // 1MB
};
```

---

## ğŸ”„ ä¸‹ä¸€æ­¥è®¡åˆ’

### ğŸ§ª æµ‹è¯•å¥—ä»¶å®Œå–„
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–æ‰€æœ‰å·¥å…·
- [ ] é›†æˆæµ‹è¯•éªŒè¯å®Œæ•´æµç¨‹
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] å®‰å…¨æ€§æµ‹è¯•

### ğŸš€ åŠŸèƒ½æ‰©å±•
- [ ] æ”¯æŒæ›´å¤šç¼–ç¨‹è¯­è¨€
- [ ] é›†æˆä»£ç è´¨é‡æ£€æŸ¥
- [ ] æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•ç”Ÿæˆ
- [ ] æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²

### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–
- [ ] å·¥å…·è°ƒç”¨ç¼“å­˜æœºåˆ¶
- [ ] å¹¶è¡Œæ–‡ä»¶æ“ä½œ
- [ ] æ™ºèƒ½ä¸Šä¸‹æ–‡å‹ç¼©
- [ ] å“åº”æ—¶é—´ç›‘æ§

---

## ğŸ’¡ å…³é”®æ´å¯Ÿ

1. **Vercel AI SDK çš„å·¥å…·è°ƒç”¨**æå¤§ç®€åŒ–äº†å¤æ‚çš„ç¼–ç¨‹ä»»åŠ¡å¤„ç†
2. **æ¨¡å¼åŒ–å¤„ç†**æä¾›äº†æ›´ç²¾ç¡®çš„ç”¨æˆ·æ„å›¾ç†è§£
3. **å®Œæ•´çš„æ–‡ä»¶æ“ä½œå·¥å…·é›†**è¦†ç›–äº†æ‰€æœ‰å¸¸è§çš„ç¼–ç¨‹åœºæ™¯
4. **æµå¼å“åº”**æä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå®æ—¶åé¦ˆ
5. **ç±»å‹å®‰å…¨**æ˜¾è‘—æé«˜äº†ä»£ç è´¨é‡å’Œç»´æŠ¤æ€§

ç¼–ç¨‹ Agent V3 æˆåŠŸå®ç°äº†æ‰€æœ‰åŸæœ‰åŠŸèƒ½ï¼ŒåŒæ—¶åœ¨æ¶æ„æ¸…æ™°åº¦ã€ä»£ç ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒæ–¹é¢éƒ½æœ‰æ˜¾è‘—æå‡ï¼Œä¸ºåç»­çš„åŠŸèƒ½æ‰©å±•å’Œä¼˜åŒ–å¥ å®šäº†åšå®åŸºç¡€ã€‚
