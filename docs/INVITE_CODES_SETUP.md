# HeysMe é‚€è¯·ç ç³»ç»Ÿè®¾ç½®æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

HeysMe é‚€è¯·ç ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„å†…æµ‹ç”¨æˆ·ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒï¼š

- ğŸ« **é‚€è¯·ç ç”Ÿæˆä¸ç®¡ç†** - çµæ´»çš„é‚€è¯·ç åˆ›å»ºå’Œé…ç½®
- ğŸ” **æƒé™æ§åˆ¶** - ä¸åŒé‚€è¯·ç æˆäºˆä¸åŒçš„ç”¨æˆ·æƒé™
- ğŸ“Š **ä½¿ç”¨ç»Ÿè®¡** - å®æ—¶è·Ÿè¸ªé‚€è¯·ç ä½¿ç”¨æƒ…å†µ
- ğŸ‘¥ **ç”¨æˆ·æ³¨å†Œé™åˆ¶** - åªæœ‰æœ‰æ•ˆé‚€è¯·ç æ‰èƒ½æ³¨å†Œ
- ğŸ›¡ï¸ **å®‰å…¨éªŒè¯** - å¤šé‡éªŒè¯ç¡®ä¿é‚€è¯·ç ä½¿ç”¨å®‰å…¨

## ğŸš€ å®‰è£…æ­¥éª¤

### 1. æ•°æ®åº“è®¾ç½®

åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œé‚€è¯·ç è¡¨ç»“æ„ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd /path/to/HeysMe-New
```

ç„¶ååœ¨ Supabase Dashboard â†’ SQL Editor ä¸­æ‰§è¡Œï¼š

```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ sql/invite-codes-schema-fixed.sql ä¸­çš„æ‰€æœ‰å†…å®¹
-- æ³¨æ„ï¼šä½¿ç”¨ invite-codes-schema-fixed.sql è€Œä¸æ˜¯ invite-codes-schema.sql
-- ä¿®å¤ç‰ˆå·²ç»è§£å†³äº† PostgreSQL æ•°ç»„è¯­æ³•é”™è¯¯
```

**é‡è¦æç¤º**ï¼š
- ä½¿ç”¨ `sql/invite-codes-schema-fixed.sql` æ–‡ä»¶
- è¯¥æ–‡ä»¶å·²ä¿®å¤äº† PostgreSQL æ•°ç»„è¯­æ³•é”™è¯¯ï¼ˆ`ARRAY['admin']` è€Œä¸æ˜¯ `'["admin"]'`ï¼‰
- è‡ªåŠ¨æ·»åŠ äº†å¿…è¦çš„ `metadata` å­—æ®µåˆ° `users` è¡¨

### 2. ç¯å¢ƒå˜é‡é…ç½®

ç¡®ä¿æ‚¨çš„ `.env.local` åŒ…å«å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼š

```env
# Supabase é…ç½®
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Clerk è®¤è¯é…ç½®
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=your_clerk_publishable_key
CLERK_SECRET_KEY=your_clerk_secret_key
CLERK_WEBHOOK_SECRET=your_webhook_secret
```

### 3. ç®¡ç†å‘˜æƒé™è®¾ç½®

è¦è®¿é—®é‚€è¯·ç ç®¡ç†åŠŸèƒ½ï¼Œéœ€è¦è®¾ç½®ç®¡ç†å‘˜ç”¨æˆ·ï¼š

1. æ³¨å†Œä¸€ä¸ªç”¨æˆ·è´¦æˆ·
2. åœ¨ Supabase â†’ Table Editor â†’ users è¡¨ä¸­ï¼Œæ‰¾åˆ°æ‚¨çš„ç”¨æˆ·è®°å½•
3. ä¿®æ”¹ä»¥ä¸‹å­—æ®µä¹‹ä¸€ï¼š
   ```sql
   -- æ–¹å¼1ï¼šè®¾ç½® plan ä¸º admin
   UPDATE users SET plan = 'admin' WHERE id = 'your_user_id';
   
   -- æ–¹å¼2ï¼šæ·»åŠ  admin é¡¹ç›®æƒé™
   UPDATE users SET projects = array_append(projects, 'admin') WHERE id = 'your_user_id';
   
   -- æ–¹å¼3ï¼šåœ¨ metadata ä¸­è®¾ç½® role
   UPDATE users SET metadata = jsonb_set(metadata, '{role}', '"admin"') WHERE id = 'your_user_id';
   ```

### 4. éªŒè¯å®‰è£…

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š
   ```bash
   npm run dev
   ```

2. è®¿é—®ç®¡ç†å‘˜é¢æ¿ï¼š
   ```
   http://localhost:3000/admin/invite-codes
   ```

3. æµ‹è¯•æ³¨å†Œé¡µé¢ï¼š
   ```
   http://localhost:3000/sign-up
   ```

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### ç”Ÿæˆé‚€è¯·ç 

1. ç™»å½•ç®¡ç†å‘˜è´¦æˆ·
2. è®¿é—® `/admin/invite-codes`
3. ç‚¹å‡»"ç”Ÿæˆé‚€è¯·ç "æŒ‰é’®
4. é…ç½®é‚€è¯·ç å‚æ•°ï¼š
   - **åç§°**ï¼šé‚€è¯·ç ç”¨é€”æè¿°
   - **æ•°é‡**ï¼šä¸€æ¬¡ç”Ÿæˆå¤šå°‘ä¸ª
   - **ä½¿ç”¨æ¬¡æ•°**ï¼šæ¯ä¸ªé‚€è¯·ç å¯ä½¿ç”¨å‡ æ¬¡
   - **è¿‡æœŸæ—¶é—´**ï¼šå¯é€‰çš„è¿‡æœŸæ—¥æœŸ
   - **ç”¨æˆ·æƒé™**ï¼šå…è´¹ç‰ˆ/ä¸“ä¸šç‰ˆç­‰

### ç”¨æˆ·æ³¨å†Œæµç¨‹

1. ç”¨æˆ·è®¿é—® `/sign-up`
2. è¾“å…¥é‚€è¯·ç å¹¶éªŒè¯
3. éªŒè¯æˆåŠŸåæ˜¾ç¤ºæ³¨å†Œè¡¨å•
4. å®Œæˆæ³¨å†Œè‡ªåŠ¨åº”ç”¨é‚€è¯·ç æƒé™

### ç›‘æ§é‚€è¯·ç ä½¿ç”¨

åœ¨ç®¡ç†é¢æ¿ä¸­å¯ä»¥ï¼š
- æŸ¥çœ‹æ‰€æœ‰é‚€è¯·ç åˆ—è¡¨
- æŸ¥çœ‹æ¯ä¸ªé‚€è¯·ç çš„ä½¿ç”¨è¯¦æƒ…
- ç¦ç”¨æˆ–åˆ é™¤é‚€è¯·ç 
- æŸ¥çœ‹æ³¨å†Œç”¨æˆ·ä¿¡æ¯

## ğŸ”§ é«˜çº§é…ç½®

### æƒé™é…ç½®

é‚€è¯·ç æƒé™é…ç½®ç¤ºä¾‹ï¼š

```typescript
const permissions = {
  plan: 'pro',                    // è´¦æˆ·ç±»å‹
  features: [                     // åŠŸèƒ½æƒé™
    'chat',
    'page_creation',
    'template_access',
    'advanced_ai'
  ],
  projects: ['HeysMe'],           // é¡¹ç›®è®¿é—®æƒé™
  special_access: true,           // ç‰¹æ®Šè®¿é—®æƒé™
  admin_access: false             // ç®¡ç†å‘˜æƒé™
}
```

### æ‰¹é‡ç®¡ç†

æ”¯æŒæ‰¹é‡ç”Ÿæˆé‚€è¯·ç ï¼š

```typescript
// ç”Ÿæˆ100ä¸ªç›¸åŒé…ç½®çš„é‚€è¯·ç 
const request = {
  name: 'å†…æµ‹ç”¨æˆ·æ‰¹é‡é‚€è¯·',
  count: 100,
  maxUses: 1,
  permissions: {
    plan: 'free',
    features: ['chat', 'page_creation']
  }
}
```

### API é›†æˆ

å¦‚æœéœ€è¦åœ¨å…¶ä»–ç³»ç»Ÿä¸­é›†æˆï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ APIï¼š

```javascript
// éªŒè¯é‚€è¯·ç 
const verifyResponse = await fetch('/api/invite-codes/verify', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ code: 'ABC12345' })
})

// ä½¿ç”¨é‚€è¯·ç 
const useResponse = await fetch('/api/invite-codes/use', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    code: 'ABC12345',
    email: 'user@example.com'
  })
})
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### é˜²æ»¥ç”¨æªæ–½

1. **IP é™åˆ¶**ï¼šè®°å½•ä½¿ç”¨é‚€è¯·ç çš„ IP åœ°å€
2. **é‚®ç®±å”¯ä¸€æ€§**ï¼šåŒä¸€é‚®ç®±ä¸èƒ½é‡å¤ä½¿ç”¨é‚€è¯·ç 
3. **ä½¿ç”¨æ¬¡æ•°é™åˆ¶**ï¼šæ¯ä¸ªé‚€è¯·ç æœ‰ä½¿ç”¨æ¬¡æ•°ä¸Šé™
4. **è¿‡æœŸæ—¶é—´**ï¼šæ”¯æŒè®¾ç½®é‚€è¯·ç è¿‡æœŸæ—¶é—´

### æƒé™éªŒè¯

1. **ç®¡ç†å‘˜éªŒè¯**ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥ç”Ÿæˆ/ç®¡ç†é‚€è¯·ç 
2. **è¡Œçº§å®‰å…¨**ï¼šä½¿ç”¨ Supabase RLS ç¡®ä¿æ•°æ®å®‰å…¨
3. **API æƒé™**ï¼šæ‰€æœ‰æ•æ„Ÿæ“ä½œéƒ½éœ€è¦è®¤è¯

### æ•°æ®ä¿æŠ¤

1. **æ•æ„Ÿä¿¡æ¯è„±æ•**ï¼šå…¬å¼€ API ä¸è¿”å›æ•æ„Ÿä¿¡æ¯
2. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰é‚€è¯·ç æ“ä½œ
3. **æ•°æ®å¤‡ä»½**ï¼šé‡è¦æ•°æ®è‡ªåŠ¨å¤‡ä»½

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ— æ³•è®¿é—®ç®¡ç†é¢æ¿**
   - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ç®¡ç†å‘˜æƒé™
   - ç¡®è®¤æ•°æ®åº“è¡¨å·²æ­£ç¡®åˆ›å»º

2. **é‚€è¯·ç éªŒè¯å¤±è´¥**
   - æ£€æŸ¥é‚€è¯·ç æ ¼å¼æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤é‚€è¯·ç æœªè¿‡æœŸä¸”æœ‰å‰©ä½™ä½¿ç”¨æ¬¡æ•°

3. **æ³¨å†Œåæƒé™æœªç”Ÿæ•ˆ**
   - æ£€æŸ¥ Clerk Webhook æ˜¯å¦æ­£ç¡®é…ç½®
   - æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ç¡®è®¤æƒé™åº”ç”¨è¿‡ç¨‹

### è°ƒè¯•å·¥å…·

1. **æ•°æ®åº“æŸ¥è¯¢**ï¼š
   ```sql
   -- æŸ¥çœ‹æ‰€æœ‰é‚€è¯·ç 
   SELECT * FROM invite_codes ORDER BY created_at DESC;
   
   -- æŸ¥çœ‹ä½¿ç”¨è®°å½•
   SELECT * FROM invite_code_usages ORDER BY used_at DESC;
   ```

2. **API æµ‹è¯•**ï¼š
   ä½¿ç”¨ Postman æˆ– curl æµ‹è¯• API ç«¯ç‚¹

3. **æ—¥å¿—ç›‘æ§**ï¼š
   æŸ¥çœ‹ Next.js æœåŠ¡å™¨æ—¥å¿—äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯

## ğŸ“š API æ–‡æ¡£

### é‚€è¯·ç éªŒè¯
- `POST /api/invite-codes/verify`
- å‚æ•°ï¼š`{ code: string }`
- è¿”å›ï¼šé‚€è¯·ç æœ‰æ•ˆæ€§å’Œæƒé™ä¿¡æ¯

### é‚€è¯·ç ä½¿ç”¨
- `POST /api/invite-codes/use`
- å‚æ•°ï¼š`{ code, email, userAgent?, ipAddress? }`
- è¿”å›ï¼šä½¿ç”¨ç»“æœå’Œæƒé™ä¿¡æ¯

### ç®¡ç†å‘˜åŠŸèƒ½
- `POST /api/admin/invite-codes/generate` - ç”Ÿæˆé‚€è¯·ç 
- `GET /api/admin/invite-codes/generate` - è·å–é‚€è¯·ç åˆ—è¡¨
- `GET /api/admin/invite-codes/[id]` - è·å–é‚€è¯·ç è¯¦æƒ…
- `PATCH /api/admin/invite-codes/[id]` - æ›´æ–°é‚€è¯·ç 
- `DELETE /api/admin/invite-codes/[id]` - åˆ é™¤é‚€è¯·ç 

## ğŸ‰ å®Œæˆ

ç°åœ¨æ‚¨å·²ç»æˆåŠŸè®¾ç½®äº† HeysMe é‚€è¯·ç ç³»ç»Ÿï¼ç”¨æˆ·éœ€è¦æœ‰æ•ˆçš„é‚€è¯·ç æ‰èƒ½æ³¨å†Œï¼Œæ‚¨å¯ä»¥é€šè¿‡ç®¡ç†é¢æ¿çµæ´»æ§åˆ¶ç”¨æˆ·è®¿é—®æƒé™ã€‚

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®åº“è¡¨æ˜¯å¦æ­£ç¡®åˆ›å»º
2. ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®
3. ç®¡ç†å‘˜æƒé™æ˜¯å¦æ­£ç¡®è®¾ç½®
4. Clerk Webhook æ˜¯å¦æ­£å¸¸å·¥ä½œ
