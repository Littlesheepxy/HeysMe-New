# ğŸš€ E2Bæ²™ç›’é¢„è§ˆç³»ç»Ÿå®æ–½æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### ğŸ¯ ç›®æ ‡
ä½¿ç”¨E2Bæ²™ç›’æŠ€æœ¯æ›¿ä»£ç°æœ‰çš„Vercelé¢„è§ˆç³»ç»Ÿï¼Œå®ç°æ›´å¿«é€Ÿçš„ä»£ç é¢„è§ˆå’Œæµ‹è¯•åŠŸèƒ½ï¼Œä¸“é—¨é€‚é…Next.jsæ¡†æ¶ã€‚

### âš¡ æ ¸å¿ƒä¼˜åŠ¿
- **æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦**ï¼šæ²™ç›’ç¯å¢ƒæ¯”Verceléƒ¨ç½²æ›´å¿«
- **å®æ—¶é¢„è§ˆ**ï¼šä»£ç å˜æ›´å³æ—¶ç”Ÿæ•ˆ
- **å®Œå…¨éš”ç¦»**ï¼šç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œé¿å…å†²çª
- **Next.jsä¼˜åŒ–**ï¼šä¸“é—¨ä¸ºNext.jsåº”ç”¨ä¼˜åŒ–

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### ğŸ“Š æ ¸å¿ƒç»„ä»¶æ¶æ„
```mermaid
graph TD
    A[ç”¨æˆ·äº¤äº’] --> B[CodePreviewToggle]
    B --> C[E2BSandboxPreview]
    C --> D[E2B APIæœåŠ¡å±‚]
    D --> E[æ²™ç›’ç®¡ç†å™¨]
    E --> F[Next.jsç¯å¢ƒ]
    F --> G[é¢„è§ˆURL]
    
    H[Coding Agent] --> I[ä»£ç ç”Ÿæˆ]
    I --> C
    C --> J[ä¾èµ–æ£€æµ‹]
    J --> K[è‡ªåŠ¨å®‰è£…]
    K --> L[å®æ—¶åˆ·æ–°]
```

### ğŸ”§ æŠ€æœ¯æ ˆé€‰æ‹©

#### âœ… **å¿…éœ€ä¾èµ–**
- `@e2b/code-interpreter`: E2B SDK
- `e2b`: æ ¸å¿ƒE2Båº“
- `next`: Next.js 15
- `react`: React 19+

#### ğŸ› ï¸ **å¼€å‘å·¥å…·**
- TypeScript 5+
- Tailwind CSS 3+
- Framer Motion (åŠ¨ç”»)
- Lucide React (å›¾æ ‡)

---

## ğŸ“… å®æ–½è®¡åˆ’ (4é˜¶æ®µ)

### ğŸ **ç¬¬ä¸€é˜¶æ®µï¼šç¯å¢ƒæ­å»º** `[COMPLETED âœ…]`
**å®é™…æ—¶é—´**ï¼š1å¤©  
**ç›®æ ‡**ï¼šåˆ›å»ºåŸºç¡€E2Bé›†æˆç¯å¢ƒ

#### âœ… å­ä»»åŠ¡æ¸…å•
- [x] å®‰è£…E2B SDKä¾èµ–
- [x] é…ç½®E2B APIå¯†é’¥
- [x] åˆ›å»ºåŸºç¡€æ²™ç›’æœåŠ¡ç±»
- [x] æµ‹è¯•E2Bè¿æ¥å’Œè®¤è¯

#### ğŸ“‚ å·²å®Œæˆæ–‡ä»¶
```
â”œâ”€â”€ package.json (æ·»åŠ E2Bä¾èµ–) âœ…
â”œâ”€â”€ .env.local (E2B APIé…ç½®) âœ… 
â”œâ”€â”€ lib/services/e2b-sandbox-service.ts (æ–°å»º) âœ…
â”œâ”€â”€ lib/config/e2b-config.ts (æ–°å»º) âœ…
â”œâ”€â”€ app/api/e2b-sandbox/test-connection/route.ts (æ–°å»º) âœ…
â””â”€â”€ app/e2b-test/page.tsx (æµ‹è¯•é¡µé¢) âœ…
```

---

### ğŸ”¨ **ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒAPIå¼€å‘** `[COMPLETED âœ…]`
**å®é™…æ—¶é—´**ï¼š1å¤©  
**ç›®æ ‡**ï¼šå®ç°å®Œæ•´çš„21ä¸ªæ ¸å¿ƒAPIç«¯ç‚¹

#### ğŸ¯ **å®Œæ•´APIç«¯ç‚¹å®ç° (21ä¸ª) - ç»Ÿä¸€ç»“æ„** âœ…

> ğŸ“ **æ‰€æœ‰E2B APIå·²ç»Ÿä¸€æ•´ç†åˆ° `/api/e2b-sandbox/` æ–‡ä»¶å¤¹ä¸‹**

##### ğŸ—ï¸ **æ²™ç›’ç®¡ç†ç±» (4ä¸ª)**
- [x] `/api/e2b-sandbox/create` - åˆ›å»ºæ²™ç›’å¹¶åˆå§‹åŒ–ç¯å¢ƒ  
- [x] `/api/e2b-sandbox/status` - æ£€æŸ¥æ²™ç›’çŠ¶æ€å’Œå¥åº·åº¦
- [x] `/api/e2b-sandbox/kill` - é”€æ¯æ²™ç›’å®ä¾‹  
- [x] `/api/e2b-sandbox/logs` - è·å–æ²™ç›’è¿è¡Œæ—¥å¿—

##### ğŸ“¦ **ä¾èµ–ç®¡ç†ç±» (2ä¸ª)**
- [x] `/api/e2b-sandbox/detect-packages` - è‡ªåŠ¨æ£€æµ‹ä»£ç ä¸­çš„ä¾èµ–å¹¶å®‰è£…
- [x] `/api/e2b-sandbox/install-packages` - æ‰‹åŠ¨å®‰è£…æŒ‡å®šçš„npmåŒ…

##### ğŸ”„ **æœåŠ¡å™¨ç®¡ç†ç±» (5ä¸ª)**
- [x] `/api/e2b-sandbox/restart-nextjs` - é‡å¯Next.jså¼€å‘æœåŠ¡å™¨
- [x] `/api/e2b-sandbox/monitor-logs` - ç›‘æ§Next.jsè¿è¡ŒçŠ¶æ€  
- [x] `/api/e2b-sandbox/check-errors` - æ£€æŸ¥Next.jsé”™è¯¯
- [x] `/api/e2b-sandbox/clear-errors-cache` - æ¸…é™¤é”™è¯¯ç¼“å­˜
- [x] `/api/e2b-sandbox/report-error` - æŠ¥å‘ŠNext.jsé”™è¯¯

##### ğŸ“‚ **æ–‡ä»¶ç®¡ç†ç±» (3ä¸ª)**
- [x] `/api/e2b-sandbox/files` - è·å–æ²™ç›’æ–‡ä»¶ç»“æ„å’Œå†…å®¹
- [x] `/api/e2b-sandbox/deploy` - åº”ç”¨AIç”Ÿæˆçš„ä»£ç åˆ°æ²™ç›’  
- [x] `/api/e2b-sandbox/apply-code-stream` - æµå¼åº”ç”¨ä»£ç ï¼ˆå®æ—¶åé¦ˆï¼‰

##### ğŸ¤– **AIäº¤äº’ç±» (3ä¸ª)**  
- [x] `/api/e2b-sandbox/generate-code-stream` - æµå¼ç”ŸæˆAIä»£ç 
- [x] `/api/e2b-sandbox/analyze-intent` - åˆ†æç¼–è¾‘æ„å›¾
- [x] `/api/e2b-sandbox/conversation-state` - ç®¡ç†å¯¹è¯çŠ¶æ€

##### ğŸ› ï¸ **å·¥å…·ç±» (4ä¸ª)**
- [x] `/api/e2b-sandbox/run-command` - åœ¨æ²™ç›’ä¸­è¿è¡Œå‘½ä»¤
- [x] `/api/e2b-sandbox/create-zip` - åˆ›å»ºé¡¹ç›®å‹ç¼©åŒ…  
- [x] `/api/e2b-sandbox/scrape-screenshot` - æˆªå–ç½‘é¡µæˆªå›¾
- [x] `/api/e2b-sandbox/scrape-url` - å¢å¼ºç‰ˆç½‘é¡µå†…å®¹æŠ“å–

##### ğŸ”§ **åŸºç¡€è®¾æ–½ (1ä¸ª)**
- [x] `/api/e2b-sandbox/test-connection` - æµ‹è¯•E2Bè¿æ¥

---

### ğŸ¨ **ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯ç»„ä»¶å¼€å‘** `[COMPLETED âœ…]`
**å®é™…æ—¶é—´**ï¼š1å¤©  
**ç›®æ ‡**ï¼šåˆ›å»ºE2Bé¢„è§ˆç»„ä»¶ï¼Œæ›¿ä»£VercelPreview

#### ğŸ§© ç»„ä»¶æ¶æ„ âœ…
```
components/editor/
â”œâ”€â”€ E2BSandboxPreview.tsx (ä¸»é¢„è§ˆç»„ä»¶) âœ…
â”œâ”€â”€ SandboxControlPanel.tsx (æ§åˆ¶é¢æ¿) âœ…
â”œâ”€â”€ CodePreviewToggle.tsx (ä¿®æ”¹é›†æˆE2B) âœ…
â””â”€â”€ hooks/
    â”œâ”€â”€ useE2BSandbox.ts (æ²™ç›’ç®¡ç†Hook) âœ…
    â”œâ”€â”€ useSandboxStatus.ts (çŠ¶æ€ç®¡ç†Hook) âœ…
    â””â”€â”€ useSandboxLogs.ts (æ—¥å¿—ç®¡ç†Hook) âœ…
```

#### âœ… å¼€å‘ä»»åŠ¡
- [x] åˆ›å»ºE2BSandboxPreviewç»„ä»¶
- [x] å®ç°æ²™ç›’æ§åˆ¶é¢æ¿ (SandboxControlPanel)
- [x] æ·»åŠ å®æ—¶çŠ¶æ€æ˜¾ç¤ºå’Œæ—¥å¿—ç›‘æ§
- [x] åˆ›å»ºè‡ªå®šä¹‰Hooks (3ä¸ª)
- [x] é›†æˆiframeé¢„è§ˆä¸è®¾å¤‡è§†å›¾åˆ‡æ¢
- [x] æ„å»ºå®Œæ•´æµ‹è¯•ç•Œé¢ (/e2b-sandbox-test)
- [x] é›†æˆåˆ°ç°æœ‰CodePreviewToggleç»„ä»¶

---

### ğŸ”— **ç¬¬å››é˜¶æ®µï¼šç³»ç»Ÿé›†æˆå’Œæµ‹è¯•** `[TODO]`
**é¢„è®¡æ—¶é—´**ï¼š2-3å¤©  
**ç›®æ ‡**ï¼šä¸ç°æœ‰Coding Agenté›†æˆï¼Œå…¨é¢æµ‹è¯•

#### ğŸ¯ é›†æˆç‚¹
- [ ] ä¿®æ”¹CodePreviewToggleæ”¯æŒE2B
- [ ] é›†æˆCoding Agentè¾“å‡º
- [ ] æ·»åŠ é¢„è§ˆæ¨¡å¼åˆ‡æ¢(Vercel/E2B)
- [ ] å®ç°é”™è¯¯å¤„ç†å’Œå›é€€

#### ğŸ§ª æµ‹è¯•ç­–ç•¥
- [ ] å•å…ƒæµ‹è¯•ï¼šAPIæ¥å£æµ‹è¯•
- [ ] é›†æˆæµ‹è¯•ï¼šCoding Agent + E2B
- [ ] æ€§èƒ½æµ‹è¯•ï¼šé¢„è§ˆé€Ÿåº¦å¯¹æ¯”
- [ ] è¾¹ç•Œæµ‹è¯•ï¼šé”™è¯¯åœºæ™¯å¤„ç†

---

## ğŸ”§ è¯¦ç»†æŠ€æœ¯å®ç°

### 1. **E2Bæ²™ç›’æœåŠ¡ç±»** `[NEXT STEP]`

```typescript
// lib/services/e2b-sandbox-service.ts
export class E2BSandboxService {
  private sandbox?: Sandbox;
  private config: E2BConfig;
  
  async createNextjsSandbox(): Promise<SandboxInfo>
  async deployCode(files: FileMap): Promise<DeployResult>  
  async installDependencies(packages: string[]): Promise<void>
  async getPreviewUrl(): Promise<string>
  async destroy(): Promise<void>
}
```

### 2. **Next.jsä¸“ç”¨é…ç½®** `[ARCHITECTURE]`

```typescript
// é’ˆå¯¹Next.jsçš„ç‰¹æ®Šé…ç½®
const NEXTJS_SANDBOX_CONFIG = {
  framework: 'nextjs',
  nodeVersion: '18.17.0',
  buildCommand: 'npm run build',
  devCommand: 'npm run dev',
  port: 3000,
  startupTimeout: 30000, // Next.jså¯åŠ¨è¾ƒæ…¢
}
```

### 3. **æ™ºèƒ½ä¾èµ–æ£€æµ‹** `[FEATURE]`

```typescript
// æ‰«æä»£ç ä¸­çš„importè¯­å¥ï¼Œè‡ªåŠ¨æ£€æµ‹Next.jsä¾èµ–
function detectNextjsDependencies(files: FileMap): {
  dependencies: string[],
  devDependencies: string[]
}
```

---

## ğŸ“Š å¼€å‘è¿›åº¦è¿½è¸ª

### ğŸ† å®Œæˆæƒ…å†µ
- âœ… **æ¶æ„è®¾è®¡å®Œæˆ** - ç³»ç»Ÿè®¾è®¡å’ŒæŠ€æœ¯é€‰å‹
- âœ… **ç¯å¢ƒæ­å»ºå®Œæˆ** - E2B SDKé›†æˆå’Œé…ç½®
- âœ… **æ ¸å¿ƒAPIå¼€å‘å®Œæˆ** - 21ä¸ªæ ¸å¿ƒæ¥å£å…¨éƒ¨å®ç°  
- â³ **å‰ç«¯ç»„ä»¶å¼€å‘ä¸­** - E2Bé¢„è§ˆç»„ä»¶
- â¸ï¸ **ç³»ç»Ÿé›†æˆå¾…å¼€å§‹** - ä¸Coding Agentå®Œæ•´é›†æˆ

### ğŸ“… å®é™…é‡Œç¨‹ç¢‘
- **Day 1**: åŸºç¡€ç¯å¢ƒæ­å»º âœ…  
- **Day 2**: æ ¸å¿ƒAPIå¼€å‘ âœ… (21ä¸ªAPIå…¨éƒ¨å®Œæˆ)
- **Day 3-4**: å‰ç«¯ç»„ä»¶å®ç° â³  
- **Day 5**: ç³»ç»Ÿé›†æˆæµ‹è¯• â¸ï¸

### ğŸ¯ **å½“å‰çŠ¶æ€æ€»ç»“**
- âœ… **E2B SDKé›†æˆ** - å®Œæ•´çš„TypeScriptæ”¯æŒ  
- âœ… **21ä¸ªæ ¸å¿ƒAPI** - 6å¤§ç±»åŠŸèƒ½æ¨¡å—å…¨è¦†ç›–
- âœ… **Next.jsä¼˜åŒ–** - ä¸“é—¨ä¸ºNext.jsè€Œä¸æ˜¯Viteä¼˜åŒ–
- âœ… **é”™è¯¯å¤„ç†** - å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿ
- âœ… **æµå¼å¤„ç†** - å®æ—¶åé¦ˆå’Œæµå¼ä»£ç åº”ç”¨

---

## ğŸš¨ é£é™©å’ŒæŒ‘æˆ˜

### âš ï¸ æŠ€æœ¯æŒ‘æˆ˜
1. **Next.jså¯åŠ¨æ—¶é—´**ï¼šæ¯”Viteæ…¢ï¼Œéœ€è¦ä¼˜åŒ–å¯åŠ¨æµç¨‹
2. **ä¾èµ–ç®¡ç†**ï¼šNext.jsä¾èµ–è¾ƒå¤æ‚ï¼Œéœ€è¦æ™ºèƒ½æ£€æµ‹
3. **ç«¯å£ç®¡ç†**ï¼šé¿å…ç«¯å£å†²çªï¼Œå®ç°åŠ¨æ€åˆ†é…
4. **å†…å­˜ç®¡ç†**ï¼šé•¿æ—¶é—´è¿è¡Œçš„æ²™ç›’éœ€è¦èµ„æºç›‘æ§

### ğŸ›¡ï¸ è§£å†³æ–¹æ¡ˆ
1. **é¢„çƒ­ç­–ç•¥**ï¼šæå‰åˆ›å»ºæ²™ç›’æ¨¡æ¿ï¼Œå‡å°‘å¯åŠ¨æ—¶é—´
2. **æ™ºèƒ½ç¼“å­˜**ï¼šç¼“å­˜å¸¸ç”¨ä¾èµ–ï¼Œé¿å…é‡å¤ä¸‹è½½
3. **å¥åº·æ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æ²™ç›’çŠ¶æ€ï¼Œè‡ªåŠ¨é‡å¯å¼‚å¸¸å®ä¾‹
4. **èµ„æºé™åˆ¶**ï¼šè®¾ç½®åˆç†çš„CPUå’Œå†…å­˜é™åˆ¶

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ğŸ“‹ **ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯ç»„ä»¶å¼€å‘**

#### âœ… **å·²å®Œæˆçš„å‡†å¤‡å·¥ä½œ**
- [x] E2B SDKä¾èµ–å·²å®‰è£…  
- [x] å®Œæ•´çš„E2Bé…ç½®ç³»ç»Ÿ
- [x] E2BSandboxServiceæ ¸å¿ƒæœåŠ¡ç±»  
- [x] 21ä¸ªæ ¸å¿ƒAPIç«¯ç‚¹å…¨éƒ¨å®ç°
- [x] å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿ

#### ğŸš§ **æ¥ä¸‹æ¥éœ€è¦å®ç°**
1. **åˆ›å»ºE2BSandboxPreviewç»„ä»¶** - æ›¿ä»£VercelPreview  
2. **ä¿®æ”¹CodePreviewToggle** - é›†æˆE2Bé¢„è§ˆé€‰é¡¹
3. **å®ç°æ²™ç›’æ§åˆ¶é¢æ¿** - çŠ¶æ€æ˜¾ç¤ºå’Œæ“ä½œç•Œé¢  
4. **æ·»åŠ å®æ—¶æ—¥å¿—æ˜¾ç¤º** - é›†æˆç›‘æ§API
5. **åˆ›å»ºè‡ªå®šä¹‰Hooks** - useE2BSandbox, useSandboxStatus

#### ğŸ§ª **æµ‹è¯•å’ŒéªŒè¯**
1. **ä¸Coding Agenté›†æˆæµ‹è¯•** - å®Œæ•´å·¥ä½œæµç¨‹
2. **æ€§èƒ½å¯¹æ¯”æµ‹è¯•** - E2B vs Vercelé¢„è§ˆé€Ÿåº¦  
3. **é”™è¯¯åœºæ™¯æµ‹è¯•** - å¼‚å¸¸å¤„ç†å’Œæ¢å¤
4. **å¤šç”¨æˆ·å¹¶å‘æµ‹è¯•** - èµ„æºç®¡ç†å’Œéš”ç¦»

### ğŸ¯ **æŠ€æœ¯è¦ç‚¹**
- **iframeé›†æˆ** - `https://${sandboxId}-3000.e2b.dev`
- **å®æ—¶çŠ¶æ€æ›´æ–°** - WebSocketæˆ–è½®è¯¢æœºåˆ¶
- **é”™è¯¯å¤„ç†UI** - ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ˜¾ç¤º  
- **é¢„è§ˆåˆ·æ–°ç­–ç•¥** - æ™ºèƒ½åˆ·æ–°å’Œç¼“å­˜ç®¡ç†

---

## ğŸ“ **å½“å‰çŠ¶æ€ç¡®è®¤** 

### âœ… **å·²å®Œæˆ (ç¬¬1-2é˜¶æ®µ)**
- **ç¯å¢ƒæ­å»º** âœ… - E2B SDKå®Œå…¨é›†æˆ
- **APIå¼€å‘** âœ… - 21ä¸ªæ ¸å¿ƒç«¯ç‚¹å…¨éƒ¨å®Œæˆ
- **æœåŠ¡ç±»** âœ… - å®Œæ•´çš„æ²™ç›’ç”Ÿå‘½å‘¨æœŸç®¡ç†

### ğŸš§ **è¿›è¡Œä¸­ (ç¬¬3é˜¶æ®µ)**  
- **å‰ç«¯ç»„ä»¶å¼€å‘** - E2Bé¢„è§ˆç»„ä»¶å’Œç•Œé¢

### â¸ï¸ **å¾…å¼€å§‹ (ç¬¬4é˜¶æ®µ)**
- **ç³»ç»Ÿå®Œæ•´é›†æˆ** - ä¸ç°æœ‰Coding Agenté›†æˆ
- **å…¨é¢æµ‹è¯•** - åŠŸèƒ½ã€æ€§èƒ½ã€è¾¹ç•Œæµ‹è¯•

**ğŸ‰ 21ä¸ªæ ¸å¿ƒAPIå·²å…¨éƒ¨å®ç°å®Œæˆï¼å‡†å¤‡è¿›å…¥å‰ç«¯ç»„ä»¶å¼€å‘é˜¶æ®µï¼** ğŸš€
