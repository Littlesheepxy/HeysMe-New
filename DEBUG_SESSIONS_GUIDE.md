# 🔍 会话和文件调试工具使用指南

## 📋 概述

我已经为你创建了一个完整的调试页面，可以帮你查看：
- 每个对话的ID和详细信息
- 每个会话关联的项目
- 各个版本的文件内容
- 临时会话和文件存储情况

## 🚀 访问方式

### 方法1: 直接访问
在浏览器中访问：`http://localhost:3000/debug-sessions`

### 方法2: 通过调试按钮
启动开发服务器后，在页面右下角会显示"调试工具"按钮

## 🔧 修复内容总结

### 1. 会话ID传递修复
- ✅ 修复了 `DatabaseFileTools.getCreateFileTool()` 的会话ID传递
- ✅ 更新了 `CodingAgent.getVercelAITools()` 传递正确的sessionData
- ✅ 解决了临时会话ID导致文件分散的问题

### 2. 调试工具创建
- ✅ 创建了 `/debug-sessions` 页面
- ✅ 创建了 `/api/debug/sessions` API端点  
- ✅ 添加了SQL查询函数用于统计分析

## 📊 调试页面功能

### 会话概览
- 显示所有会话的ID、状态、创建时间
- 统计关联的项目数量和版本数量

### 项目详情
- 显示每个会话关联的项目
- 对比数据库记录的文件数vs实际文件数
- 显示项目创建时间和状态

### 版本历史
- 展示每个项目的所有版本
- 点击版本可查看具体文件列表
- 显示文件内容长度和类型信息

### 临时会话分析
- 特别标识临时会话创建的项目
- 帮助定位增量模式创建的文件

## 🎯 使用场景

### 1. 验证修复效果
访问调试页面查看：
- `session-1756995786645-a4p27u64q` 是否正确关联到项目
- 5个组件文件是否在正确的项目中
- 版本信息是否完整

### 2. 问题诊断
- 查看哪些文件保存在临时会话中
- 对比不同会话的文件分布
- 检查数据一致性问题

### 3. 数据迁移验证
- 验证文件从临时项目到正式项目的迁移
- 确认版本历史的完整性

## 🔍 关键信息说明

### 会话ID格式
- 真实会话: `session-1756995786645-a4p27u64q`
- 临时会话: `temp-session-1756996416198`

### 项目ID格式  
- 正式项目: `proj_1756995813620_2xpxhco6`
- 临时项目: `proj_1756996416679_hzvmydvg`

### 文件状态
- ✅ 正常：关联到真实会话的项目
- ⚠️ 临时：保存在临时会话项目中
- ❌ 丢失：数据库统计与实际不符

## 📈 预期结果

修复后应该看到：
1. `session-1756995786645-a4p27u64q` 会话包含完整的5个组件文件
2. 临时会话项目逐渐减少（随着修复生效）
3. 文件显示从8个配置文件变为5个组件文件

## 🛠️ 下一步

1. 启动开发服务器：`npm run dev`
2. 访问调试页面：`http://localhost:3000/debug-sessions` 
3. 检查当前数据状态
4. 测试增量模式，验证文件是否保存到正确位置
5. 对比修复前后的数据变化

这个工具将帮助你完全理解文件存储的整个流程，并验证我们的修复是否生效！
