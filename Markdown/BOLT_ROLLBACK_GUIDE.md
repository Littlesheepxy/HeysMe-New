# Bolt æ•°æ®åº“é›†æˆå›æ»šæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—æä¾›äº†å››ä¸ªå›æ»šè„šæœ¬æ¥æ’¤é”€ Bolt ä¸ HeysMe çš„æ•°æ®åº“é›†æˆï¼š

1. **`rollback_bolt_integration_fixed.sql`** - å®Œæ•´å›æ»šè„šæœ¬ï¼ˆä¿®å¤ç‰ˆæœ¬ï¼Œæ¨èï¼‰
2. **`quick_rollback_bolt_fixed.sql`** - å¿«é€Ÿå›æ»šè„šæœ¬ï¼ˆä¿®å¤ç‰ˆæœ¬ï¼Œç´§æ€¥ä½¿ç”¨ï¼‰
3. **`rollback_bolt_integration.sql`** - åŸå§‹å®Œæ•´å›æ»šè„šæœ¬ï¼ˆå¯èƒ½æœ‰å‡½æ•°ä¾èµ–é—®é¢˜ï¼‰
4. **`quick_rollback_bolt.sql`** - åŸå§‹å¿«é€Ÿå›æ»šè„šæœ¬ï¼ˆå¯èƒ½æœ‰å‡½æ•°ä¾èµ–é—®é¢˜ï¼‰

## âš ï¸ é‡è¦è­¦å‘Š

> **æ•°æ®å®‰å…¨è­¦å‘Šï¼šæ‰§è¡Œå›æ»šè„šæœ¬å°†æ°¸ä¹…åˆ é™¤æ‰€æœ‰ Bolt ç›¸å…³æ•°æ®ï¼**
> 
> - æ‰€æœ‰ Bolt é¡¹ç›®æ–‡ä»¶å°†è¢«åˆ é™¤
> - æ‰€æœ‰å·¥ä½œå°å¿«ç…§å°†ä¸¢å¤±
> - æ‰€æœ‰éƒ¨ç½²è®°å½•å°†è¢«æ¸…é™¤
> - æ‰€æœ‰åä½œä¼šè¯å°†ç»ˆæ­¢
> - **æ­¤æ“ä½œä¸å¯é€†è½¬ï¼**

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: ä½¿ç”¨ Supabase Dashboardï¼ˆæ¨èï¼‰

1. ç™»å½•åˆ° [Supabase Dashboard](https://app.supabase.com)
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. è¿›å…¥ **SQL Editor**
4. å¤åˆ¶å¹¶ç²˜è´´ `rollback_bolt_integration_fixed.sql` çš„å†…å®¹
5. ç‚¹å‡» **Run** æ‰§è¡Œè„šæœ¬

### æ–¹æ³• 2: ä½¿ç”¨æœ¬åœ° psql å®¢æˆ·ç«¯

```bash
# è¿æ¥åˆ°ä½ çš„ Supabase æ•°æ®åº“
psql "postgresql://[USERNAME]:[PASSWORD]@[HOST]:[PORT]/postgres"

# æ‰§è¡Œå›æ»šè„šæœ¬
\i rollback_bolt_integration_fixed.sql
```

### æ–¹æ³• 3: ä½¿ç”¨é¡¹ç›®ä¸­çš„ Supabase CLI

```bash
# ç¡®ä¿å·²è¿æ¥åˆ°æ­£ç¡®çš„é¡¹ç›®
supabase status

# æ‰§è¡Œå›æ»šè„šæœ¬
psql --dbname=postgresql://localhost:54322/postgres --file=rollback_bolt_integration_fixed.sql
```

## ğŸ“Š å›æ»šè„šæœ¬å¯¹æ¯”

| ç‰¹æ€§ | ä¿®å¤ç‰ˆå®Œæ•´å›æ»š | ä¿®å¤ç‰ˆå¿«é€Ÿå›æ»š | åŸå§‹å®Œæ•´å›æ»š | åŸå§‹å¿«é€Ÿå›æ»š |
|------|---------------|---------------|-------------|-------------|
| **å‡½æ•°ä¾èµ–å¤„ç†** | âœ… æ­£ç¡®å¤„ç† | âœ… æ­£ç¡®å¤„ç† | âŒ å¯èƒ½å¤±è´¥ | âŒ å¯èƒ½å¤±è´¥ |
| **å®‰å…¨æ£€æŸ¥** | âœ… å®Œæ•´éªŒè¯ | âŒ æ— éªŒè¯ | âœ… å®Œæ•´éªŒè¯ | âŒ æ— éªŒè¯ |
| **é”™è¯¯å¤„ç†** | âœ… è¯¦ç»†å¤„ç† | âš ï¸ åŸºç¡€å¤„ç† | âœ… è¯¦ç»†å¤„ç† | âš ï¸ åŸºç¡€å¤„ç† |
| **è¿›åº¦æç¤º** | âœ… è¯¦ç»†æ—¥å¿— | âŒ ç®€å•çŠ¶æ€ | âœ… è¯¦ç»†æ—¥å¿— | âŒ ç®€å•çŠ¶æ€ |
| **ä¾èµ–æ¸…ç†** | âœ… å®Œæ•´æ¸…ç† | âš ï¸ ä¾èµ–çº§è” | âœ… å®Œæ•´æ¸…ç† | âš ï¸ ä¾èµ–çº§è” |
| **æ‰§è¡Œæ—¶é—´** | è¾ƒæ…¢ | å¾ˆå¿« | è¾ƒæ…¢ | å¾ˆå¿« |
| **æ¨èåœºæ™¯** | ç”Ÿäº§ç¯å¢ƒ | ç´§æ€¥æ¢å¤ | æµ‹è¯•ç¯å¢ƒ | æµ‹è¯•ç¯å¢ƒ |

## ğŸ¯ é€‰æ‹©åˆé€‚çš„è„šæœ¬

### ä½¿ç”¨ä¿®å¤ç‰ˆå®Œæ•´å›æ»šè„šæœ¬çš„æƒ…å†µï¼š
- âœ… ç”Ÿäº§ç¯å¢ƒå›æ»š
- âœ… éœ€è¦è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—
- âœ… è¦ç¡®ä¿å®Œå…¨æ¸…ç†
- âœ… æœ‰æ—¶é—´è¿›è¡Œå……åˆ†éªŒè¯
- âœ… **é¿å…å‡½æ•°ä¾èµ–é”™è¯¯**

### ä½¿ç”¨ä¿®å¤ç‰ˆå¿«é€Ÿå›æ»šè„šæœ¬çš„æƒ…å†µï¼š
- âš¡ ç´§æ€¥æƒ…å†µéœ€è¦å¿«é€Ÿæ¢å¤
- âš¡ æµ‹è¯•ç¯å¢ƒå¿«é€Ÿé‡ç½®
- âš¡ ç¡®å®šæ²¡æœ‰é‡è¦æ•°æ®éœ€è¦ä¿ç•™
- âš¡ **é¿å…å‡½æ•°ä¾èµ–é”™è¯¯**

### åŸå§‹è„šæœ¬çš„é—®é¢˜ï¼š
- âŒ å¯èƒ½é‡åˆ° `update_updated_at_column()` å‡½æ•°ä¾èµ–é”™è¯¯
- âŒ éœ€è¦æ‰‹åŠ¨å¤„ç†å‡½æ•°ä¾èµ–å…³ç³»
- âŒ å»ºè®®ä»…ç”¨äºæµ‹è¯•ç¯å¢ƒ

## ğŸ”§ å‡½æ•°ä¾èµ–é—®é¢˜è¯´æ˜

### é—®é¢˜æè¿°ï¼š
åŸå§‹å›æ»šè„šæœ¬å°è¯•åˆ é™¤ `update_updated_at_column()` å‡½æ•°ï¼Œä½†è¯¥å‡½æ•°è¢«å¤šä¸ªç°æœ‰è¡¨çš„è§¦å‘å™¨ä½¿ç”¨ï¼š

- `chat_sessions` è¡¨
- `pages` è¡¨  
- `page_blocks` è¡¨
- `page_shares` è¡¨
- `page_builds` è¡¨
- `user_pages` è¡¨
- `templates` è¡¨
- `creator_verifications` è¡¨
- `user_sensitive_data` è¡¨
- `user_credits` è¡¨
- `user_documents` è¡¨
- `document_parsing_jobs` è¡¨
- `document_parsing_cache` è¡¨

### è§£å†³æ–¹æ¡ˆï¼š
ä¿®å¤ç‰ˆè„šæœ¬ï¼š
- âœ… åªåˆ é™¤ Bolt ä¸“ç”¨çš„å‡½æ•°
- âœ… ä¿ç•™é€šç”¨çš„ `update_updated_at_column()` å‡½æ•°
- âœ… é¿å…å½±å“ç°æœ‰ç³»ç»Ÿçš„è§¦å‘å™¨

## ğŸ“‹ æ‰§è¡Œå‰æ£€æŸ¥æ¸…å•

### ğŸ” æ‰§è¡Œå‰å¿…é¡»æ£€æŸ¥ï¼š

- [ ] **æ•°æ®å¤‡ä»½**ï¼šç¡®è®¤å·²å¤‡ä»½é‡è¦æ•°æ®
- [ ] **ç¯å¢ƒç¡®è®¤**ï¼šç¡®è®¤å½“å‰è¿æ¥çš„æ˜¯æ­£ç¡®çš„æ•°æ®åº“
- [ ] **æƒé™æ£€æŸ¥**ï¼šç¡®è®¤æœ‰è¶³å¤Ÿçš„æ•°æ®åº“æƒé™
- [ ] **ä¾èµ–ç¡®è®¤**ï¼šç¡®è®¤æ²¡æœ‰å…¶ä»–ç³»ç»Ÿä¾èµ– Bolt ç›¸å…³è¡¨
- [ ] **æ—¶é—´å®‰æ’**ï¼šé€‰æ‹©ä½å³°æ—¶æ®µæ‰§è¡Œ
- [ ] **è„šæœ¬é€‰æ‹©**ï¼šä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬é¿å…å‡½æ•°ä¾èµ–é—®é¢˜

### ğŸ“ å¤‡ä»½é‡è¦æ•°æ®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦ä¿ç•™æŸäº› Bolt æ•°æ®ï¼Œè¯·åœ¨å›æ»šå‰æ‰§è¡Œï¼š

```sql
-- å¤‡ä»½ Bolt é¡¹ç›®æ–‡ä»¶
CREATE TABLE bolt_project_files_backup AS SELECT * FROM public.bolt_project_files;

-- å¤‡ä»½å·¥ä½œå°å¿«ç…§
CREATE TABLE bolt_workbench_snapshots_backup AS SELECT * FROM public.bolt_workbench_snapshots;

-- å¤‡ä»½éƒ¨ç½²è®°å½•
CREATE TABLE bolt_deployments_backup AS SELECT * FROM public.bolt_deployments;

-- å¤‡ä»½ chat_sessions ä¸­çš„ Bolt æ•°æ®
CREATE TABLE chat_sessions_bolt_backup AS 
SELECT id, bolt_data, bolt_workbench_state, bolt_file_tree, bolt_preview_url 
FROM public.chat_sessions 
WHERE bolt_data IS NOT NULL;
```

## âœ… éªŒè¯å›æ»šæˆåŠŸ

å›æ»šå®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ç¡®è®¤æˆåŠŸï¼š

### 1. æ£€æŸ¥è¡¨æ˜¯å¦å·²åˆ é™¤
```sql
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name LIKE 'bolt_%';
-- åº”è¯¥è¿”å›ç©ºç»“æœ
```

### 2. æ£€æŸ¥å­—æ®µæ˜¯å¦å·²åˆ é™¤
```sql
SELECT column_name 
FROM information_schema.columns 
WHERE table_schema = 'public' 
AND column_name LIKE 'bolt_%';
-- åº”è¯¥è¿”å›ç©ºç»“æœ
```

### 3. æ£€æŸ¥å­˜å‚¨æ¡¶æ˜¯å¦å·²åˆ é™¤
```sql
SELECT id FROM storage.buckets WHERE id = 'bolt-projects';
-- åº”è¯¥è¿”å›ç©ºç»“æœ
```

### 4. æ£€æŸ¥ Bolt ä¸“ç”¨å‡½æ•°æ˜¯å¦å·²åˆ é™¤
```sql
SELECT routine_name 
FROM information_schema.routines 
WHERE routine_schema = 'public' 
AND routine_name IN (
  'get_bolt_session_details',
  'cleanup_bolt_data', 
  'update_bolt_file_updated_at'
);
-- åº”è¯¥è¿”å›ç©ºç»“æœ
```

### 5. éªŒè¯é€šç”¨å‡½æ•°ä»ç„¶å­˜åœ¨
```sql
SELECT routine_name 
FROM information_schema.routines 
WHERE routine_schema = 'public' 
AND routine_name = 'update_updated_at_column';
-- åº”è¯¥è¿”å› 1 è¡Œç»“æœ
```

## ğŸ”„ é‡æ–°é›†æˆ Bolt

å¦‚æœéœ€è¦é‡æ–°é›†æˆ Boltï¼Œè¯·ï¼š

1. ç¡®è®¤å›æ»šå®Œå…¨æˆåŠŸ
2. é‡æ–°è¿è¡ŒåŸå§‹çš„ Bolt é›†æˆè¿ç§»è„šæœ¬
3. é‡æ–°é…ç½®ç›¸å…³çš„åº”ç”¨ä»£ç 

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆï¼š

#### é”™è¯¯ï¼šå‡½æ•°ä¾èµ–é—®é¢˜
```sql
ERROR: cannot drop function update_updated_at_column() because other objects depend on it
```
**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ä¿®å¤ç‰ˆå›æ»šè„šæœ¬ï¼Œå®ƒä¼šæ­£ç¡®å¤„ç†å‡½æ•°ä¾èµ–å…³ç³»

#### é”™è¯¯ï¼šæƒé™ä¸è¶³
```sql
ERROR: permission denied for relation [table_name]
```
**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿ä½¿ç”¨å…·æœ‰è¶³å¤Ÿæƒé™çš„æ•°æ®åº“ç”¨æˆ·ï¼ˆé€šå¸¸æ˜¯é¡¹ç›®æ‰€æœ‰è€…æˆ– postgres è§’è‰²ï¼‰

#### é”™è¯¯ï¼šä¾èµ–å¯¹è±¡å­˜åœ¨
```sql
ERROR: cannot drop table [table_name] because other objects depend on it
```
**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨å®Œæ•´å›æ»šè„šæœ¬ï¼Œå®ƒä¼šå¤„ç†ä¾èµ–å…³ç³»

#### é”™è¯¯ï¼šè¡¨ä¸å­˜åœ¨
```sql
ERROR: table "[table_name]" does not exist
```
**è§£å†³æ–¹æ¡ˆ**ï¼šè¿™æ˜¯æ­£å¸¸çš„ï¼Œè¯´æ˜è¡¨å·²ç»è¢«åˆ é™¤æˆ–ä»æœªåˆ›å»º

### éƒ¨åˆ†å›æ»šå¤±è´¥çš„å¤„ç†ï¼š

å¦‚æœæŸäº›æ­¥éª¤å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œç‰¹å®šçš„æ¸…ç†æ“ä½œï¼š

```sql
-- æ‰‹åŠ¨åˆ é™¤å‰©ä½™çš„è¡¨
DROP TABLE IF EXISTS public.bolt_project_files CASCADE;
DROP TABLE IF EXISTS public.bolt_workbench_snapshots CASCADE;
-- ... å…¶ä»–è¡¨

-- æ‰‹åŠ¨åˆ é™¤å‰©ä½™çš„å­—æ®µ
ALTER TABLE public.chat_sessions DROP COLUMN IF EXISTS bolt_data;
-- ... å…¶ä»–å­—æ®µ

-- æ‰‹åŠ¨åˆ é™¤ Bolt ä¸“ç”¨å‡½æ•°ï¼ˆä¸åˆ é™¤é€šç”¨å‡½æ•°ï¼‰
DROP FUNCTION IF EXISTS public.get_bolt_session_details(text);
DROP FUNCTION IF EXISTS public.cleanup_bolt_data(integer);
DROP FUNCTION IF EXISTS public.update_bolt_file_updated_at();
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœåœ¨å›æ»šè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥æ•°æ®åº“æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. ç¡®è®¤æ•°æ®åº“è¿æ¥å’Œæƒé™
3. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
4. è€ƒè™‘åœ¨æµ‹è¯•ç¯å¢ƒå…ˆè¡ŒéªŒè¯
5. ä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬é¿å…å‡½æ•°ä¾èµ–é—®é¢˜

## ğŸ“ æ›´æ–°æ—¥å¿—

- **v1.0.1** - ä¿®å¤ç‰ˆæœ¬ï¼Œæ­£ç¡®å¤„ç†å‡½æ•°ä¾èµ–å…³ç³»
  - ä¿®å¤ `update_updated_at_column()` å‡½æ•°ä¾èµ–é—®é¢˜
  - åªåˆ é™¤ Bolt ä¸“ç”¨å‡½æ•°ï¼Œä¿ç•™é€šç”¨å‡½æ•°
  - æ·»åŠ è¯¦ç»†çš„å‡½æ•°ä¾èµ–è¯´æ˜
- **v1.0.0** - åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«å®Œæ•´å’Œå¿«é€Ÿå›æ»šè„šæœ¬
  - æ”¯æŒå®Œæ•´çš„ Bolt é›†æˆæ’¤é”€
  - åŒ…å«è¯¦ç»†çš„éªŒè¯å’Œé”™è¯¯å¤„ç† 