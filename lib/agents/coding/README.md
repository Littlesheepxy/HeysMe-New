# Coding Agent æ¨¡å—æ–‡æ¡£

## ğŸ“ æ–‡ä»¶å¤¹æ¦‚è¿°

`/lib/agents/coding` æ˜¯ HeysMe é¡¹ç›®ä¸­åŸºäº Cline æ¶æ„è®¾è®¡çš„ AI é©±åŠ¨ä»£ç ç”Ÿæˆç³»ç»Ÿã€‚è¯¥æ¨¡å—å®ç°äº†å®Œæ•´çš„ä»£ç ç”Ÿæˆã€å·¥å…·æ‰§è¡Œã€æµå¼å¤„ç†å’ŒçŠ¶æ€ç®¡ç†åŠŸèƒ½ã€‚

## ğŸ“‹ æ–‡ä»¶æ¸…å•

| æ–‡ä»¶å | å¤§å° | è¡Œæ•° | åŠŸèƒ½ç®€è¿° |
|--------|------|------|----------|
| `types.ts` | 17KB | 636è¡Œ | ğŸ¯ **ç»Ÿä¸€ç±»å‹å®šä¹‰** - æ‰€æœ‰æ¥å£å’Œç±»å‹ |
| `agent.ts` | 24KB | 744è¡Œ | ğŸ¤– **æ ¸å¿ƒä»£ç†** - ä¸»è¦çš„AIä»£ç ç”Ÿæˆé€»è¾‘ |
| `utils.ts` | 16KB | 650è¡Œ | ğŸ”§ **å·¥å…·å‡½æ•°** - è¾…åŠ©å‡½æ•°å’Œå¸¸é‡é…ç½® |
| `streaming-tool-executor.ts` | 11KB | 390è¡Œ | ğŸŒŠ **æµå¼å·¥å…·æ‰§è¡Œå™¨** - å®æ—¶å·¥å…·è°ƒç”¨å¤„ç† |
| `ai-service-adapter.ts` | 15KB | 518è¡Œ | ğŸ”Œ **AIæœåŠ¡é€‚é…å™¨** - è¿æ¥å¤–éƒ¨AIæœåŠ¡ |
| `cline-sync-manager.ts` | 14KB | 485è¡Œ | ğŸ”„ **ClineåŒæ­¥ç®¡ç†å™¨** - ç‰ˆæœ¬åŒæ­¥å’Œæ›´æ–° |
| `code_preview.md` | 3.9KB | 131è¡Œ | ğŸ“‹ **æµç¨‹åˆ†ææ–‡æ¡£** - ä»£ç é¢„è§ˆæµç¨‹è¯´æ˜ |
| `index.ts` | 102B | 6è¡Œ | ğŸ“¦ **æ¨¡å—å¯¼å‡º** - ç»Ÿä¸€å¯¼å‡ºæ¥å£ |

---

## ğŸ¯ æ ¸å¿ƒæ–‡ä»¶è¯¦è§£

### 1. **types.ts** - ç»Ÿä¸€ç±»å‹ç³»ç»Ÿ
```typescript
// ğŸ¯ æ ¸å¿ƒç±»å‹å®šä¹‰ä¸­å¿ƒ
- CodingAgentMessage          // æ¶ˆæ¯ç±»å‹ç³»ç»Ÿ
- CodingAgentState           // çŠ¶æ€ç®¡ç†æ¥å£
- CodingAgentAsk/Say         // äº¤äº’ç±»å‹å®šä¹‰
- CodeFile                   // ä»£ç æ–‡ä»¶æ¥å£
- CodingAgentMessageFactory  // æ¶ˆæ¯å·¥å‚ç±»
```

**åŠŸèƒ½ç‰¹ç‚¹:**
- âœ… ç»Ÿä¸€æ‰€æœ‰é‡å¤çš„ç±»å‹å®šä¹‰
- âœ… æ”¯æŒ Ask/Say äº¤äº’æ¨¡å¼
- âœ… å®Œæ•´çš„æ–‡ä»¶æ“ä½œç±»å‹
- âœ… æµå¼å¤„ç†çŠ¶æ€ç®¡ç†
- âœ… å·¥å…·æ‰§è¡Œç»“æœç±»å‹

### 2. **agent.ts** - æ ¸å¿ƒAIä»£ç†
```typescript
// ğŸ¤– ä¸»è¦çš„CodingAgentå®ç°
export class CodingAgent extends BaseAgent {
  async* process() // æµå¼AIä»£ç ç”Ÿæˆ
  handleStreamingAIGeneration() // å¤„ç†æµå¼è¾“å‡º
  extractCodeBlocksFromText() // ä»£ç å—æå–
  generateFallbackFiles() // å¤‡ç”¨æ–‡ä»¶ç”Ÿæˆ
}
```

**æ ¸å¿ƒåŠŸèƒ½:**
- ğŸ¯ **AIä»£ç ç”Ÿæˆ**: è°ƒç”¨Claude/OpenAIç”Ÿæˆå®Œæ•´é¡¹ç›®
- ğŸŒŠ **æµå¼å¤„ç†**: å®æ—¶æ˜¾ç¤ºä»£ç ç”Ÿæˆè¿‡ç¨‹
- ğŸ“ **æ–‡ä»¶ç®¡ç†**: åˆ›å»ºã€ä¿®æ”¹ã€ç»„ç»‡ä»£ç æ–‡ä»¶
- ğŸ”§ **é”™è¯¯å¤„ç†**: æ™ºèƒ½é‡è¯•å’Œé™çº§æ–¹æ¡ˆ
- ğŸ“‹ **é¡¹ç›®ç±»å‹**: æ”¯æŒç®€å†ã€ä½œå“é›†ã€åšå®¢ç­‰å¤šç§é¡¹ç›®

### 3. **utils.ts** - å·¥å…·å‡½æ•°åº“
```typescript
// ğŸ”§ å¸¸é‡å’Œå·¥å…·å‡½æ•°é›†åˆ
export const BASE_DEPENDENCIES    // åŸºç¡€ä¾èµ–åŒ…
export const STYLING_DEPENDENCIES // æ ·å¼ä¾èµ–åŒ…
export const COLOR_SCHEMES        // é¢œè‰²ä¸»é¢˜é…ç½®

export function generatePackageJson() // ç”Ÿæˆpackage.json
export function generateTailwindConfig() // ç”ŸæˆTailwindé…ç½®
export function extractUserGoal() // æå–ç”¨æˆ·ç›®æ ‡
```

**ä¸»è¦æ¨¡å—:**
- ğŸ“¦ **ä¾èµ–ç®¡ç†**: Next.jsã€Reactã€TailwindCSSç­‰é¢„é…ç½®
- ğŸ¨ **ä¸»é¢˜ç³»ç»Ÿ**: 5ç§å†…ç½®é¢œè‰²ä¸»é¢˜
- âš™ï¸ **é…ç½®ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®é…ç½®æ–‡ä»¶
- ğŸ¯ **æ•°æ®æå–**: ä»ä¼šè¯ä¸­æå–ç”¨æˆ·æ„å›¾

### 4. **streaming-tool-executor.ts** - æµå¼å·¥å…·æ‰§è¡Œ
```typescript
// ğŸŒŠ åŸºäºClineæ¶æ„çš„æµå¼å·¥å…·æ‰§è¡Œ
export class StreamingToolExecutor {
  processStreamChunk() // å¤„ç†æµå¼æ•°æ®å—
  executeActualTool() // æ‰§è¡Œå…·ä½“å·¥å…·
}

export class StreamingToolParser {
  parseStreamingContent() // è§£æå·¥å…·è°ƒç”¨æ ‡ç­¾
}
```

**æ ¸å¿ƒç‰¹æ€§:**
- ğŸ”§ **å®æ—¶å·¥å…·è°ƒç”¨**: write_to_file, read_file, execute_command
- ğŸ“ **æ–‡æœ¬ä¸å·¥å…·åˆ†ç¦»**: æ™ºèƒ½è¯†åˆ«æ–‡æœ¬å†…å®¹å’Œå·¥å…·è°ƒç”¨
- âš¡ **å¼‚æ­¥æ‰§è¡Œ**: æ”¯æŒå¹¶å‘å·¥å…·æ‰§è¡Œ
- ğŸ¯ **é”™è¯¯æ¢å¤**: å·¥å…·æ‰§è¡Œå¤±è´¥è‡ªåŠ¨é‡è¯•

### 5. **ai-service-adapter.ts** - AIæœåŠ¡é€‚é…å™¨
```typescript
// ğŸ”Œ è¿æ¥Coding Agentå’ŒAgentOrchestratorç³»ç»Ÿ
export class CodingAgentAIServiceAdapter {
  sendMessage() // å‘é€æ¶ˆæ¯åˆ°AIæœåŠ¡
  handleStreaming() // å¤„ç†æµå¼å“åº”
  mapResponseFormat() // æ ¼å¼è½¬æ¢
}
```

**é€‚é…åŠŸèƒ½:**
- ğŸ¤– **å¤šAIæœåŠ¡**: æ”¯æŒOpenAIã€Claudeã€æœ¬åœ°æ¨¡å‹
- ğŸ”„ **æ ¼å¼è½¬æ¢**: ç»Ÿä¸€ä¸åŒAIæœåŠ¡çš„å“åº”æ ¼å¼
- ğŸŒŠ **æµå¼å¤„ç†**: å®æ—¶å¤„ç†AIæµå¼è¾“å‡º
- âš¡ **æ€§èƒ½ä¼˜åŒ–**: ç¼“å­˜å’Œæ‰¹å¤„ç†ä¼˜åŒ–

### 6. **cline-sync-manager.ts** - ClineåŒæ­¥ç®¡ç†
```typescript
// ğŸ”„ ç”¨äºåŒæ­¥Clineæ›´æ–°çš„ç®¡ç†å™¨
export class ClineSyncManager {
  checkForUpdates() // æ£€æŸ¥ç‰ˆæœ¬æ›´æ–°
  syncComponent() // åŒæ­¥ç»„ä»¶
  generateUpdateReport() // ç”Ÿæˆæ›´æ–°æŠ¥å‘Š
}
```

**åŒæ­¥åŠŸèƒ½:**
- ğŸ“¥ **ç‰ˆæœ¬æ£€æµ‹**: è‡ªåŠ¨æ£€æŸ¥Clineæ–°ç‰ˆæœ¬
- ğŸ”„ **ç»„ä»¶åŒæ­¥**: æ™ºèƒ½åŒæ­¥ç±»å‹å®šä¹‰å’Œç»„ä»¶
- ğŸ“‹ **æ›´æ–°æŠ¥å‘Š**: ç”Ÿæˆè¯¦ç»†çš„æ›´æ–°è¯´æ˜
- ğŸ›¡ï¸ **å¤‡ä»½æ¢å¤**: åŒæ­¥å‰è‡ªåŠ¨å¤‡ä»½

### 7. **code_preview.md** - æµç¨‹åˆ†ææ–‡æ¡£
**å†…å®¹æ¦‚è¦:**
- ğŸ“‹ å®Œæ•´çš„æ–‡ä»¶åˆ›å»ºå’Œé¢„è§ˆæµç¨‹åˆ†æ
- ğŸ”„ ä»AIç”Ÿæˆåˆ°ç”¨æˆ·ç¼–è¾‘çš„æ•°æ®æµè½¬
- ğŸ¨ FileTreeã€CodeEditorã€WebContaineré›†æˆæ–¹å¼
- ğŸš€ ç”¨æˆ·ä½“éªŒä¼˜åŒ–ç­–ç•¥

### 8. **index.ts** - æ¨¡å—å¯¼å‡º
```typescript
// ğŸ“¦ ç»Ÿä¸€æ¨¡å—å¯¼å‡º
export { CodingAgent } from './agent';
export * from './utils';
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **ğŸ¯ å•ä¸€èŒè´£**: æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰æ˜ç¡®çš„åŠŸèƒ½è¾¹ç•Œ
2. **ğŸ”Œ æ¨¡å—åŒ–**: é«˜å†…èšã€ä½è€¦åˆçš„æ¨¡å—è®¾è®¡
3. **ğŸŒŠ æµå¼ä¼˜å…ˆ**: æ”¯æŒå®æ—¶ã€æµå¼çš„ç”¨æˆ·ä½“éªŒ
4. **ğŸ”§ å·¥å…·å¯¼å‘**: åŸºäºå·¥å…·è°ƒç”¨çš„AIäº¤äº’æ¨¡å¼
5. **ğŸ¨ ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹ç³»ç»Ÿ

### æ•°æ®æµå‘

```mermaid
graph TB
    A[ç”¨æˆ·è¾“å…¥] --> B[agent.ts]
    B --> C[ai-service-adapter.ts]
    C --> D[streaming-tool-executor.ts]
    D --> E[utils.ts]
    E --> F[ChatInterfaceæ˜¾ç¤º]
    
    G[types.ts] --> B
    G --> C
    G --> D
    G --> E
    
    H[cline-sync-manager.ts] --> G
    
    style A fill:#e1f5fe
    style F fill:#f3e5f5
    style G fill:#fff3e0
```

### äº¤äº’æ¨¡å¼

```typescript
// ğŸ¯ Ask/Say äº¤äº’æ¨¡å¼
Ask: 'code_review' â†’ ç”¨æˆ·ç¡®è®¤ä»£ç å®¡æŸ¥
Say: 'file_created' â†’ AIé€šçŸ¥æ–‡ä»¶å·²åˆ›å»º

// ğŸŒŠ æµå¼å·¥å…·æ‰§è¡Œ
"æ­£åœ¨ç”Ÿæˆä»£ç ..." â†’ <write_to_file> â†’ "æ–‡ä»¶åˆ›å»ºå®Œæˆ"
```

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºæœ¬ä½¿ç”¨
```typescript
import { CodingAgent } from '@/lib/agents/coding';

// åˆ›å»ºCoding Agentå®ä¾‹
const agent = new CodingAgent();

// æµå¼å¤„ç†ç”¨æˆ·è¯·æ±‚
for await (const response of agent.process(userInput, sessionData)) {
  console.log(response);
}
```

### é›†æˆåˆ°ChatInterface
```typescript
// ChatInterfaceä¼šè‡ªåŠ¨æ£€æµ‹codingæ¨¡å¼
if (sessionStatus?.currentStage === 'coding') {
  setIsCodingMode(true); // è‡ªåŠ¨å¯ç”¨CodingåŠŸèƒ½
}
```

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½

- ğŸ¤– **AIä»£ç ç”Ÿæˆ**: Claude/OpenAIé©±åŠ¨çš„å®Œæ•´é¡¹ç›®ç”Ÿæˆ
- ğŸŒŠ **æµå¼äº¤äº’**: å®æ—¶æ˜¾ç¤ºä»£ç ç”Ÿæˆè¿‡ç¨‹
- ğŸ”§ **å·¥å…·æ‰§è¡Œ**: write_to_file, read_fileç­‰å·¥å…·è°ƒç”¨
- ğŸ“ **æ–‡ä»¶ç®¡ç†**: åˆ›å»ºã€ä¿®æ”¹ã€é¢„è§ˆä»£ç æ–‡ä»¶
- ğŸ¨ **ä¸»é¢˜ç³»ç»Ÿ**: 5ç§å†…ç½®è®¾è®¡ä¸»é¢˜
- âš¡ **é”™è¯¯å¤„ç†**: æ™ºèƒ½é‡è¯•å’Œé™çº§æ–¹æ¡ˆ
- ğŸ”„ **ç‰ˆæœ¬åŒæ­¥**: ä¸Clineå®˜æ–¹ç‰ˆæœ¬ä¿æŒåŒæ­¥

### ğŸ¯ æŠ€æœ¯ä¼˜åŠ¿

1. **ç»Ÿä¸€æ¶æ„**: åŸºäºClineæ¶æ„ï¼Œä¸“ä¸šçº§ä»£ç ç”Ÿæˆ
2. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹ç³»ç»Ÿ
3. **æµå¼ä½“éªŒ**: ä»ç”Ÿæˆåˆ°é¢„è§ˆçš„æ— ç¼è¡”æ¥
4. **æ¨¡å—åŒ–è®¾è®¡**: æ˜“äºç»´æŠ¤å’Œæ‰©å±•
5. **æ™ºèƒ½é€‚é…**: è‡ªåŠ¨æ£€æµ‹å’Œåˆ‡æ¢æ¨¡å¼

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Clineå®˜æ–¹æ–‡æ¡£](https://github.com/cline/cline)
- [ChatInterfaceé›†æˆè¯´æ˜](../../components/chat/README.md)
- [ç±»å‹ç³»ç»Ÿæ–‡æ¡£](./types.ts)
- [ä»£ç é¢„è§ˆæµç¨‹](./code_preview.md)

---

## ğŸ”§ å¼€å‘è¯´æ˜

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- TypeScript 5.0+
- Next.js 15.0+

### å…³é”®ä¾èµ–
- `@webcontainer/api` - WebContaineré›†æˆ
- `framer-motion` - åŠ¨ç”»æ•ˆæœ
- `monaco-editor` - ä»£ç ç¼–è¾‘å™¨

### è°ƒè¯•æ¨¡å¼
è®¿é—® `/test-coding-agent` é¡µé¢è¿›è¡ŒåŠŸèƒ½æµ‹è¯•å’Œè°ƒè¯•ã€‚

---

*è¯¥æ¨¡å—æ˜¯HeysMe AIé©±åŠ¨èŒä¸šé¡µé¢åˆ¶ä½œå¹³å°çš„æ ¸å¿ƒç»„ä»¶ï¼Œæä¾›ä¸“ä¸šçº§çš„ä»£ç ç”Ÿæˆå’Œç¼–è¾‘ä½“éªŒã€‚* ğŸš€ 